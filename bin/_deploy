#!/bin/bash

source _color_logs


echo_info "Copiando arquivos"
cp -n example.env .env
cp -n ../conf/examples/db.env ../conf/.db.env
cp -n ../conf/examples/ege.env ../conf/.ege.env
cp -n ../conf/examples/acesso.env ../conf/.acesso.env
cp -n ../conf/examples/perfil.env ../conf/.perfil.env
cp -n ../conf/examples/seletivo.env ../conf/.seletivo.env
cp -n ../conf/examples/selecao.env ../conf/.selecao.env
cp -n ../conf/examples/integrador_ms.env ../conf/.integrador_ms.env
cp -n ../conf/examples/integrador_ui.env ../conf/.integrador_ui.env

if [[ ! -e ../conf/.acesso_ldap.env ]]; then
    echo "" > ../conf/.acesso_ldap.env
fi


echo ""
echo_info "Parar o mundo"
./_down

echo ""
echo_info "Construir o mundo"
./_build

echo ""
echo_info "Subir o banco"
./db_up

echo ""
echo_info "Migrar os bancos..."

echo ""
echo_info "... acesso"
./acesso_migrate

echo ""
echo_info "... perfil"
./perfil_migrate

echo ""
echo_info "... seletivo"
./seletivo_migrate


echo ""
echo_info "Iniciando o ambiente de desenvolvimento"
./acesso_run ./manage.sh init_dev

echo ""
echo_info "Parar o mundo novamente"
./_down

echo ""
echo_success "Tudo pronto"
